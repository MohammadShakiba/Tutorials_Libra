1. Generate the SK files with the format that is supported by the Odin software.

For this project, we need all the pairs for C, O, Ti, and H atoms, so run it as:


        skgen -o slateratom -t sktwocnt sktable -d C,H,O,Ti C,H,O,Ti

Make sure to edit the `skdef.hdf` file as needed.

In the skdef file, make sure that the maximal distance for the radial grid isn't too large
otherwise, for large distances the atomic DFT problem becomes numerically shaky

Two pre-generated sets of SK files are already provided for you in this tutorial, so just unpack the archive:

        tar -xjf skfiles.tar.bz2   # default MaxDistance = 6, except in cutoffs

 or 

        tar -xjf skfiles2.tar.bz2   # MaxDistance = 6, everywhere 

 or 

        tar -xjf skfiles3.tar.bz2   # MaxDistance = 20, everywhere


2. Run regular MD using DFTB+

 A. Edit the `dftb_in_md.hsd` and `run-md.py` files as needed. 

 **Note** for this step, use a different SK file, those generated with the skgen in my examples
 aren't giving good geometries. Ideally, one needs to use a consistent set of SK files for the
 MD and following time-overlap calculation steps

        tar -xjf matsci-0-3.tar.bz2

 B. Run MD calculations

        python run-md.py


3. Convert the DFTB+-produced MD trajectory to a more common format

 A. Edit the `run-md-2.hsd` file as needed

 B. Run

        python run-md-2.py


4. Align computed MD trajectory

 A. Edit the `align.py` file as needed

 B. Run

        python align.py


5. Run TD-DFTB calculations to determine desired active space and states

 A. Edit the `dftb_tddftb.hsd` and `run_tddftb.py` files as needed

 Here and in the following steps, we can use the SK files generated by the `skprogs`
 but one need to be careful since some of them may give wrong overlaps - use 
 those with smaller radial grids.

 B. Run

        python run-tddftb.py


6. Compute single-particle time-overlaps and energies

 A. Edit the `dftb_in_ham1.hsd`, `dftb_in_ham2.hsd`, and `run-nacs.py` file as needed

 B. Run

        python run-nacs.py


 Pay attention to the following diagnostic printouts:
 
        Solving eigenvalue problem - max elt of error =  0.4717914202802478
        Checking the sub-eigenvalue problem - max elt of error =  0.4717914202802478
        Checking the orthogonality 8.11790088275921e-13

 Ideally, they should be small enough (close to zero), otherwise:

 - change the eigensolver parameter in the `run-nacs.py` file;
 - or you may need reconsider the quality of your skprogs-generated SK files. But if you going to change the SK prefix 
   to use, make sure it is consistent in all 3 files edited in step 6A

7. Based on the Step 3 calculations, define the Slater Determinants to be used and run the mapping

 A. Edit the `run-mapping.py` file as needed

 B. Run

        python run-mapping.py


The pre-computed (reference) matrices for the basis of 4 lowest states is provided in the
archive:

        tar -xf ham_sd.tar.bz2


Some options to explore are the ways of computing the time-overlaps of Slater determinants.

```
   mapping2.ovlp_mat_arb(basis2, basis2, St[0][i]) 

   gives - s_sd_0_re:

0.99981325  3.3096451e-06  -3.1916283e-06  3.5625368e-07
3.3096451e-06  0.99981470  4.1159022e-06  6.0290704e-07
-3.1916283e-06  4.1159022e-06  0.99980358  1.3447262e-12
3.5625368e-07  6.0290704e-07  1.3447262e-12  0.99981891

  and - st_sd_0_re:

0.032344311  -0.0026897154  -2.9946935e-06  7.3882192e-07
0.0030274267  0.035089429  2.9480845e-06  -1.9310282e-05
-1.1103746e-06  -5.1501000e-05  0.030740506  2.8265983e-08
-2.5199439e-05  5.8922073e-06  2.6799854e-09  0.038883284
```

```
   st = mapping.ovlp_mat_arb(basis2, basis2, st, use_minimal=False, use_mo_approach=False, user_notation=0)

   gives - s_sd_0_re:

0.99981332  3.3096451e-06  -3.1916286e-06  3.5625371e-07
3.3096451e-06  0.99981475  4.1159024e-06  6.0290705e-07
-3.1916286e-06  4.1159024e-06  0.99980366  1.3447260e-12
3.5625371e-07  6.0290705e-07  1.3447260e-12  0.99981892


  and  - st_sd_0_re:

0.032344311  -0.0026897152  -2.9946927e-06  7.3882194e-07
0.0030274268  0.035089429  2.9480843e-06  -1.9310282e-05
-1.1103745e-06  -5.1501000e-05  0.030740503  2.8265983e-08
-2.5199439e-05  5.8922069e-06  2.6799849e-09  0.038883284 
```
  

8. Finally, run the NA-MD calculations

 A. Edit the `run-namd.py` file as needed

 B. Run

        python run-namd.py

 C. The `NBRA` folder shall already contain some reference calculations.
    When you run your own calculations, the results will be overwritten, so
    make sure you save the reference results




